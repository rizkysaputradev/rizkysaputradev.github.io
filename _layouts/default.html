<!doctype html>
<html lang="en">
  <head>

    <!-- =========================
         THEME PRELOAD (NO FLASH)
         ========================= -->
    <script>
      (function () {
        try {
          var saved = localStorage.getItem("theme"); // "dark" | "light"
          if (saved === "light" || saved === "dark") {
            document.documentElement.setAttribute("data-theme", saved);
          }
        } catch (e) {}
      })();
    </script>

    {% include head.html %}
  </head>

  <body>
    {% include nav.html %}

    <main class="container">
      {{ content }}
    </main>

    {% include footer.html %}

    <!-- =========================
         IMAGE LIGHTBOX (EXISTING)
         ========================= -->
    <div id="lightbox" class="lightbox" aria-hidden="true">
      <img id="lightbox-img" alt="">
      <button
        id="lightbox-close"
        class="lightbox-close"
        type="button"
        aria-label="Close"
      >
        ×
      </button>
    </div>

    <script>
    (function () {
      const lightbox = document.getElementById("lightbox");
      const lightboxImg = document.getElementById("lightbox-img");
      const closeBtn = document.getElementById("lightbox-close");

      if (!lightbox || !lightboxImg || !closeBtn) return;

      function open(src, alt) {
        lightboxImg.src = src;
        lightboxImg.alt = alt || "";
        lightbox.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function close() {
        lightbox.classList.remove("active");
        lightboxImg.src = "";
        document.body.style.overflow = "";
      }

      document.addEventListener("click", (e) => {
        const img = e.target.closest(".proj-slider img");
        if (!img) return;
        open(img.getAttribute("src"), img.getAttribute("alt"));
      });

      closeBtn.addEventListener("click", close);
      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) close();
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") close();
      });
    })();
    </script>

    <!-- =========================
         THEME TOGGLE LOGIC
         ========================= -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("themeToggle");
      if (!btn) return;

      function getTheme() {
        return document.documentElement.getAttribute("data-theme") || "dark";
      }

      function setTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        try {
          localStorage.setItem("theme", theme);
        } catch (e) {}

        const icon = btn.querySelector(".theme-toggle-icon");
        if (icon) {
          icon.textContent = (theme === "light") ? "☼" : "☾";
        }
      }

      // Initialize icon on load
      setTheme(getTheme());

      btn.addEventListener("click", () => {
        const next = (getTheme() === "light") ? "dark" : "light";
        setTheme(next);
      });
    });
    </script>

  </body>
</html>
